# Requirements Document

## Introduction

Данная функция добавляет поддержку OpenAI API как альтернативного провайдера для саммаризации сообщений в телеграм-боте. Система должна позволять переключаться между текущим провайдером (Cloudflare AI) и новым провайдером (OpenAI) через конфигурацию, сохраняя при этом все существующие функции саммаризации.

## Requirements

### Requirement 1

**User Story:** Как администратор бота, я хочу иметь возможность выбирать между разными провайдерами AI для саммаризации, чтобы использовать наиболее подходящий сервис для моих потребностей.

#### Acceptance Criteria

1. WHEN администратор устанавливает переменную окружения SUMMARY_PROVIDER в значение "openai" THEN система SHALL использовать OpenAI API для всех операций саммаризации
2. WHEN администратор устанавливает переменную окружения SUMMARY_PROVIDER в значение "cloudflare" или не устанавливает её THEN система SHALL использовать текущий Cloudflare AI провайдер
3. WHEN система инициализируется THEN она SHALL валидировать конфигурацию провайдера и выдавать понятные ошибки при неправильной настройке

### Requirement 2

**User Story:** Как администратор бота, я хочу настроить OpenAI API ключ и модель через переменные окружения, чтобы контролировать доступ и выбор модели.

#### Acceptance Criteria

1. WHEN используется OpenAI провайдер THEN система SHALL требовать переменную окружения OPENAI_API_KEY
2. WHEN используется OpenAI провайдер AND переменная OPENAI_MODEL установлена THEN система SHALL использовать указанную модель
3. WHEN используется OpenAI провайдер AND переменная OPENAI_MODEL не установлена THEN система SHALL использовать модель по умолчанию "gpt-4.1-nano"
4. WHEN OpenAI API ключ отсутствует или неверен THEN система SHALL логировать ошибку и возвращать понятное сообщение пользователю

### Requirement 3

**User Story:** Как пользователь бота, я хочу получать саммаризацию того же качества независимо от выбранного провайдера, чтобы мой опыт использования оставался консистентным.

#### Acceptance Criteria

1. WHEN используется OpenAI провайдер THEN система SHALL применять те же параметры генерации (temperature, max_tokens, top_p) что и для Cloudflare AI
2. WHEN происходит саммаризация через OpenAI THEN результат SHALL иметь тот же формат и структуру что и при использовании Cloudflare AI
3. WHEN используется OpenAI провайдер THEN система SHALL поддерживать все существующие функции: саммаризация по дням, саммаризация последних сообщений, чанкинг больших текстов

### Requirement 4

**User Story:** Как разработчик, я хочу иметь четкое разделение логики провайдеров, чтобы код был поддерживаемым и расширяемым для добавления новых провайдеров в будущем.

#### Acceptance Criteria

1. WHEN добавляется новый провайдер THEN система SHALL использовать абстракцию/интерфейс для всех провайдеров AI
2. WHEN происходит вызов AI THEN система SHALL направлять запрос к соответствующему провайдеру на основе конфигурации
3. WHEN добавляется поддержка нового провайдера THEN существующий код саммаризации SHALL оставаться неизменным
4. WHEN происходит ошибка провайдера THEN система SHALL логировать детали ошибки с указанием используемого провайдера

### Requirement 5

**User Story:** Как администратор системы, я хочу видеть в логах какой провайдер используется для саммаризации, чтобы отслеживать использование и диагностировать проблемы.

#### Acceptance Criteria

1. WHEN происходит саммаризация THEN система SHALL логировать используемый провайдер (cloudflare/openai)
2. WHEN происходит ошибка AI провайдера THEN система SHALL включать в лог информацию о провайдере и модели
3. WHEN система запускается THEN она SHALL логировать активный провайдер и его конфигурацию (без секретных данных)