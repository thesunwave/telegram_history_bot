# Рефакторинг промптов для анализа мата

## Проблема
Промпты для анализа матерной лексики были захардкожены в коде (`src/providers/ai-provider.ts`), что делало их сложными для настройки и изменения без перекомпиляции кода.

## Решение
Перенесли промпты в конфигурацию, следуя паттерну, используемому для других промптов в системе (например, `SUMMARY_PROMPT`, `SUMMARY_SYSTEM`).

## Изменения

### 1. Добавлены новые переменные окружения в `src/env.ts`:
```typescript
PROFANITY_SYSTEM_PROMPT?: string;
PROFANITY_USER_PROMPT?: string;
```

### 2. Добавлены промпты в конфигурацию `wrangler.jsonc`:
```jsonc
"PROFANITY_SYSTEM_PROMPT": "Ты эксперт по анализу русского языка...",
"PROFANITY_USER_PROMPT": "Проанализируй следующий текст на наличие матерной лексики..."
```

### 3. Рефакторинг `src/providers/ai-provider.ts`:
- Удалены захардкоженные константы `PROFANITY_SYSTEM_PROMPT` и `PROFANITY_USER_PROMPT`
- Добавлены дефолтные промпты как fallback
- Создана функция `getProfanityPrompts(env)` для получения промптов из конфигурации

### 4. Обновлены провайдеры:
- `OpenAIProvider.analyzeProfanity()` теперь принимает параметр `env` и использует промпты из конфигурации
- `CloudflareAIProvider.analyzeProfanity()` аналогично обновлен
- Обновлен интерфейс `AIProvider` для поддержки нового параметра

### 5. Обновлены тесты:
- Добавлены новые переменные в mock environment
- Обновлены сигнатуры методов в mock провайдерах
- Создан новый тест `tests/profanity-prompts.test.ts` для проверки функции `getProfanityPrompts()`

## Преимущества

1. **Гибкость конфигурации**: Промпты можно изменять без перекомпиляции кода
2. **Консистентность**: Следует тому же паттерну, что и другие промпты в системе
3. **Fallback механизм**: Если промпты не настроены, используются дефолтные значения
4. **Тестируемость**: Легко тестировать с различными конфигурациями промптов

## Обратная совместимость
Все изменения полностью обратно совместимы. Если новые переменные не настроены, система будет использовать дефолтные промпты, идентичные предыдущим захардкоженным значениям.

## Тесты
Все 108 тестов проходят успешно, включая:
- 16 тестов для анализа мата
- 5 новых тестов для конфигурации промптов
- 76 тестов провайдеров
- 20 интеграционных тестов
- 11 основных тестов системы